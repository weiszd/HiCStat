version: '3.8'

services:
  hicstream:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: hicstream
    ports:
      - "8020:8020"
    volumes:
      # Mount host root as read-only (rslave needed because mount source includes daemon root)
      - type: bind
        source: /
        target: /data
        read_only: true
        bind:
          propagation: rslave
    environment:
      # Optional: Set timezone
      - TZ=UTC
    command: >
      -d /data
      -p 8020
      --extensions .hic
    restart: unless-stopped
    # Security options
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      # Allow Python to write temporary files if needed
      - /tmp
    labels:
      - "com.hicstream.description=HiC file streaming server with Range request support"
      - "com.hicstream.version=1.0"

# Optional: create a network
networks:
  default:
    name: hicstream-network
